{% extends "frontend/base.html" %}
{% load static %}

{% block title %}Report a Masjid{% endblock %}

{% block content %}

<!-- ===== Hero ===== -->
<section class="report-hero">
  <div class="container">
    <div class="section-heading fade-up" style="padding-top:2rem">
      <div class="section-tag">Contribute</div>
      <h2 style="color:var(--white)">Report a Masjid</h2>
      <p style="color:rgba(255,255,255,.7)">
        Help build the global registry by submitting a masjid you know.
      </p>
    </div>
  </div>
</section>

<section class="py-5" style="margin-top:-3rem;position:relative;z-index:10">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8">

        {% if auth_required %}
        <!-- Not logged in -->
        <div class="auth-card text-center fade-up">
          <i class="fas fa-lock" style="font-size:3rem;color:var(--accent);opacity:.5"></i>
          <h4 class="mt-3 fw-bold" style="color:var(--primary-dark)">Login Required</h4>
          <p class="text-muted">You need to be logged in to report a masjid.</p>
          <a href="{% url 'login' %}?next={% url 'report' %}" class="btn btn-al-primary">
            <i class="fas fa-sign-in-alt me-2"></i>Sign In
          </a>
          <p class="text-muted mt-3 mb-0" style="font-size:.85rem">
            Don't have an account? <a href="{% url 'register' %}">Register here</a>
          </p>
        </div>

        {% else %}
        <!-- Report form -->
        <div class="auth-card fade-up">

          {% if is_admin %}
          <div class="report-role-banner admin-role mb-3">
            <i class="fas fa-mosque"></i>
            <div>
              <strong>Masjid Admin â€” Direct Submit</strong>
              <span>Your masjid will be live immediately at C0. Upload verification documents in your dashboard to upgrade confidence.</span>
            </div>
          </div>
          {% else %}
          <div class="report-role-banner user-role mb-3">
            <i class="fas fa-users"></i>
            <div>
              <strong>Community Report</strong>
              <span>Your masjid will start at C0. Once 3 community members verify it, it will upgrade to C1.</span>
            </div>
          </div>
          {% endif %}

          <form method="post" action="{% url 'report' %}" autocomplete="off">
            {% csrf_token %}

            <h5 class="fw-bold mb-3" style="color:var(--primary-dark)">
              <i class="fas fa-mosque text-accent me-2"></i>Masjid Details
            </h5>

            <div class="row g-3">
              <div class="col-12">
                <label for="report-name" class="form-label fw-semibold">Masjid Name *</label>
                <div class="input-icon-wrapper">
                  <i class="fas fa-mosque"></i>
                  <input type="text" name="name" class="form-control auth-input" id="report-name"
                         placeholder="e.g. Masjid Al-Noor" required>
                </div>
              </div>
              <div class="col-12">
                <label for="report-desc" class="form-label fw-semibold">Description</label>
                <textarea name="description" class="form-control auth-input" id="report-desc" rows="3"
                          placeholder="Brief description of the masjid..." style="padding-left:1rem"></textarea>
              </div>
            </div>

            <h5 class="fw-bold mb-3 mt-4" style="color:var(--primary-dark)">
              <i class="fas fa-map-marker-alt text-accent me-2"></i>Location
            </h5>

            <div class="row g-3">
              <div class="col-md-6">
                <label for="report-city" class="form-label fw-semibold">City *</label>
                <div class="input-icon-wrapper">
                  <i class="fas fa-city"></i>
                  <input type="text" name="city" class="form-control auth-input" id="report-city"
                         placeholder="e.g. London" required>
                </div>
              </div>
              <div class="col-md-6">
                <label for="report-country" class="form-label fw-semibold">Country *</label>
                <select name="country" class="form-select auth-input" id="report-country" required style="padding-left:1rem">
                  <option value="">Select country...</option>
                  {% for c in countries %}
                  <option value="{{ c }}">{{ c }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="col-md-6">
                <label for="report-region" class="form-label fw-semibold">Region / State</label>
                <div class="input-icon-wrapper">
                  <i class="fas fa-map"></i>
                  <input type="text" name="region" class="form-control auth-input" id="report-region"
                         placeholder="e.g. Greater London">
                </div>
              </div>
              <div class="col-md-3">
                <label for="report-lat" class="form-label fw-semibold">Latitude *</label>
                <input type="number" step="any" name="latitude" class="form-control auth-input" id="report-lat"
                       placeholder="51.5074" required>
              </div>
              <div class="col-md-3">
                <label for="report-lng" class="form-label fw-semibold">Longitude *</label>
                <input type="number" step="any" name="longitude" class="form-control auth-input" id="report-lng"
                       placeholder="-0.1278" required>
              </div>
            </div>

            <!-- Map picker -->
            <div class="mt-3">
              <label class="form-label fw-semibold">
                <i class="fas fa-crosshairs text-accent me-1"></i>
                Click on the map to set coordinates
              </label>
              <div id="report-map" style="height:300px;border-radius:var(--radius-lg);border:1px solid var(--border)"></div>
            </div>

            <button type="submit" class="btn btn-al-primary w-100 mt-4">
              <i class="fas fa-paper-plane me-2"></i>Submit Masjid
            </button>
          </form>
        </div>
        {% endif %}

      </div>
    </div>
  </div>
</section>

{% endblock %}